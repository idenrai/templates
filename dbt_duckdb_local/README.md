# dbt_duckdb_local

## 개요

dbt project 를 손쉽게 검증할 수 있도록 로컬 개발 환경을 구축하기

## 상세

아래의 순서로 기재

- dbt
- duckdb
- dbt project 를 작성하여, duckdb 와 연계

### dbt

[https://docs.getdbt.com/docs/core/pip-install](https://docs.getdbt.com/docs/core/pip-install)

기본적으로는 아래의 커맨드로 인스톨 가능

```shell
pip install dbt-core dbt-duckdb
```

#### dbt project 작성 (본 템플릿 상에선 실행하지 않아도 됨)

`dbt init` 으로 프로젝트 작성

### duckdb

[https://duckdb.org/#quickinstall](https://duckdb.org/#quickinstall)

```shell
brew install duckdb
```

#### Create DB (본 템플릿 상에선 실행하지 않아도 됨)

아래의 커맨드로 간단히 DB 작성 가능

```shell
duckdb [DB 명].db
```

예시)

```shell
duckdb dbt_sample.db
```

#### DB 접속

```shell
duckdb dbt_sample.db
```

### dbt 와 duckdb 연결

#### profile 수정

dbt project (dbt_local_duckdb) 에, 위에서 만든 DB（dbt_sample）를 연결

```shell
vi ~/.dbt/profiles.yml
```

해당하는 dbt project 에 아래의 내용을 입력

```shell
[dbt project name]:
  outputs:
   dev:
     type: duckdb
     path: [duckdb 에서 만든 DB 의 패스]
  target: dev
```

예시)

```shell
dbt_duckdb:
  outputs:
   dev:
     type: duckdb
     path: /Users/idenrai/project/templates/dbt_duckdb_local/dbt_sample.db
  target: dev
```

#### 연결 확인

csv 파일을 seeds 폴더에 넣어, `dbt seed` 를 실시

[https://docs.getdbt.com/docs/build/seeds](https://docs.getdbt.com/docs/build/seeds)

CSV 파일을 읽어들여, 연결된 DB에 테이블을 작성해 준다.

여기에선 [일본 정부가 공개하는 GDP 데이터](https://www.esri.cao.go.jp/jp/sna/menu.html)를 살짝 가공한 `gdp_value.csv` 를 사용하였다.

#### 테이블 작성 확인

duckdb에 접속하여, gdp_value 테이블이 작성되었고, 데이터가 제대로 들어갔는지 확인

```text
idenrai@idenrai dbt_duckdb_local % duckdb dbt_sample.db
v1.0.0 1f98600c2c
Enter ".help" for usage hints.
D .tables
gdp_value
D select * from gdp_value;
┌───────┬─────────┬──────────┬───┬───────────────┬──────────────┬──────────────────────┬──────────────────────┐
│ Year  │ Quarter │   GDP    │ … │ PrivateDemand │ PublicDemand │ Gross Fixed Capita…  │ Final Sales of Dom…  │
│ int32 │  int32  │  double  │   │    double     │    double    │        double        │        double        │
├───────┼─────────┼──────────┼───┼───────────────┼──────────────┼──────────────────────┼──────────────────────┤
│  1994 │       1 │ 446250.8 │ … │      346421.4 │     115942.2 │             139766.7 │             442187.2 │
│  1994 │       2 │ 443808.1 │ … │      341677.8 │     118660.0 │             141500.1 │             445616.1 │
│  1994 │       3 │ 448907.8 │ … │      348092.0 │     117728.8 │             142081.0 │             448126.5 │
│  1994 │       4 │ 447171.3 │ … │      346887.9 │     117252.8 │             141344.8 │             447542.2 │
│  1995 │       1 │ 452053.4 │ … │      353551.3 │     116207.8 │             140426.6 │             449482.7 │
│  1995 │       2 │ 456335.3 │ … │      356510.3 │     118226.0 │             144020.3 │             454670.1 │
│  1995 │       3 │ 461691.2 │ … │      359658.7 │     122463.5 │             147931.0 │             459101.9 │
│  1995 │       4 │ 462853.6 │ … │      362307.2 │     122953.8 │             150009.2 │             461175.2 │
│  1996 │       1 │ 466596.2 │ … │      363070.4 │     126279.3 │             153189.0 │             464155.5 │
│  1996 │       2 │ 472543.7 │ … │      371540.1 │     125197.3 │             156552.5 │             469116.3 │
│  1996 │       3 │ 473162.4 │ … │      372531.1 │     123426.5 │             156743.3 │             471096.4 │
│  1996 │       4 │ 478445.8 │ … │      376615.5 │     123485.3 │             156264.0 │             475402.6 │
│  1997 │       1 │ 479603.8 │ … │      377568.0 │     122618.9 │             155435.9 │             479336.8 │
│  1997 │       2 │ 476074.5 │ … │      370854.2 │     122803.9 │             152820.3 │             473196.5 │
│  1997 │       3 │ 477007.7 │ … │      371998.4 │     123214.1 │             152037.8 │             472133.0 │
│  1997 │       4 │ 477180.7 │ … │      371468.1 │     121724.2 │             150734.1 │             472803.4 │
│  1998 │       1 │ 471330.7 │ … │      368894.0 │     119016.3 │             146434.8 │             467397.1 │
│  1998 │       2 │ 469303.0 │ … │      365607.2 │     119222.0 │             144820.9 │             467170.1 │
│  1998 │       3 │ 470146.4 │ … │      364412.6 │     121261.8 │             145452.0 │             470046.7 │
│  1998 │       4 │ 473905.7 │ … │      364041.5 │     125613.0 │             146820.1 │             471583.5 │
│    ·  │       · │     ·    │ · │          ·    │         ·    │                 ·    │                 ·    │
│    ·  │       · │     ·    │ · │          ·    │         ·    │                 ·    │                 ·    │
│    ·  │       · │     ·    │ · │          ·    │         ·    │                 ·    │                 ·    │
│  2019 │       2 │ 556550.6 │ … │      417494.6 │     138367.2 │             140577.6 │             553539.8 │
│  2019 │       3 │ 557558.9 │ … │      419277.5 │     139148.1 │             142427.9 │             557551.7 │
│  2019 │       4 │ 541736.9 │ … │      402960.3 │     139445.0 │             135265.9 │             540459.7 │
│  2020 │       1 │ 544427.3 │ … │      405843.8 │     139352.3 │             138031.1 │             545541.2 │
│  2020 │       2 │ 502708.7 │ … │      377392.8 │     141467.9 │             133662.6 │             501879.0 │
│  2020 │       3 │ 530176.9 │ … │      388278.8 │     143548.5 │             132146.2 │             531912.6 │
│  2020 │       4 │ 539475.8 │ … │      394697.3 │     144360.6 │             133716.9 │             541699.9 │
│  2021 │       1 │ 541081.4 │ … │      395229.9 │     144084.8 │             135129.0 │             540220.9 │
│  2021 │       2 │ 543758.9 │ … │      398119.5 │     145459.0 │             136506.1 │             543139.6 │
│  2021 │       3 │ 542014.6 │ … │      394310.8 │     146391.8 │             134533.5 │             540346.2 │
│  2021 │       4 │ 548619.1 │ … │      403181.2 │     144699.2 │             134191.0 │             546777.8 │
│  2022 │       1 │ 545558.4 │ … │      402241.2 │     144190.1 │             133165.5 │             541333.6 │
│  2022 │       2 │ 551948.1 │ … │      407913.4 │     144162.1 │             133592.1 │             549285.9 │
│  2022 │       3 │ 550893.0 │ … │      410139.4 │     144205.0 │             135720.8 │             548447.1 │
│  2022 │       4 │ 552903.0 │ … │      409104.5 │     145461.3 │             134883.6 │             550532.3 │
│  2023 │       1 │ 559270.9 │ … │      415542.1 │     146063.1 │             137814.8 │             555082.4 │
│  2023 │       2 │ 564406.4 │ … │      411518.8 │     146073.2 │             136862.7 │             560727.0 │
│  2023 │       3 │ 558676.3 │ … │      407245.0 │     145674.5 │             135977.4 │             558195.3 │
│  2023 │       4 │ 558760.9 │ … │      407207.3 │     144857.1 │             136810.4 │             558814.8 │
│  2024 │       1 │ 554727.9 │ … │      405552.1 │     144579.3 │             135397.3 │             553200.2 │
├───────┴─────────┴──────────┴───┴───────────────┴──────────────┴──────────────────────┴──────────────────────┤
│ 121 rows (40 shown)                                                                    27 columns (7 shown) │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
D
```
